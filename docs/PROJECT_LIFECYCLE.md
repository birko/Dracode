# Project Lifecycle in KoboldLair

## Overview

Projects in KoboldLair are **REAL DATA**, not placeholders. They follow a complete lifecycle from creation through execution.

## Current State

**Status:** No projects exist yet  
**Why:** You're starting with a fresh installation  
**What you see:** Empty dropdown in Dragon page  
**What happens:** API returns `[]` (empty array)

## Project Lifecycle

```
┌─────────────────────────────────────────────────────────────────┐
│                    PROJECT LIFECYCLE                            │
└─────────────────────────────────────────────────────────────────┘

1. USER CREATES PROJECT
   ↓
   User: Dragon page → Create new project "MyApp"
   ↓
   
2. DRAGON GATHERS REQUIREMENTS
   ↓
   User: Chats with Dragon about requirements
   Dragon: Asks clarifying questions
   ↓
   
3. SPECIFICATION CREATED
   ↓
   Dragon: Creates MyApp_specification.md in ./specifications/
   ↓
   
4. PROJECT AUTO-REGISTERED
   ↓
   DragonService: Calls ProjectService.RegisterProject()
   ProjectRepository: Saves to ./projects/projects.json
   ↓
   Project: {
     id: "abc-123",
     name: "MyApp",
     status: "New",
     specificationPath: "./specifications/MyApp_specification.md",
     outputPath: "./workspace/MyApp",
     createdAt: "2026-01-27T..."
   }
   ↓
   
5. WYRM ASSIGNED (Background Service)
   ↓
   WyrmProcessingService: Detects new project
   ProjectService: Assigns Wyrm
   Wyrm: Analyzes specification
   ↓
   
6. TASKS GENERATED
   ↓
   Wyrm: Creates task breakdown
   Project: status → "Analyzed"
   Tasks: Saved as task files
   ↓
   
7. DRAKE SUPERVISES
   ↓
   DrakeMonitoringService: Detects tasks
   Drake: Assigns tasks to Kobolds
   ↓
   
8. KOBOLDS EXECUTE
   ↓
   Kobolds: Write actual code
   Output: Files in ./workspace/MyApp/
   ↓
   
9. PROJECT COMPLETE
   ↓
   Project: status → "Complete"
   Output: Working code in workspace
```

## Data Flow

```
┌──────────┐
│  Dragon  │ → Creates spec.md
└────┬─────┘
     │
     ↓ Auto-registers
┌────────────────┐
│ ProjectService │ → Saves to projects.json
└────┬───────────┘
     │
     ↓ Assigns
┌────────────┐
│    Wyrm    │ → Analyzes & creates tasks
└────┬───────┘
     │
     ↓ Supervises
┌────────────┐
│   Drake    │ → Manages execution
└────┬───────┘
     │
     ↓ Executes
┌────────────┐
│  Kobolds   │ → Write code
└────────────┘
```

## Storage Locations

### 1. Project Metadata
**File:** `./projects/projects.json`
**Format:** JSON array of Project objects
**Persists:** Yes, across server restarts
**Created:** When first project is registered

**Example:**
```json
[
  {
    "id": "550e8400-e29b-41d4-a716-446655440000",
    "name": "MyWebApp",
    "status": "Analyzed",
    "specificationPath": "./specifications/MyWebApp_specification.md",
    "outputPath": "./workspace/MyWebApp",
    "wyrmId": "wyrm-001",
    "taskFiles": [
      "task_001.json",
      "task_002.json"
    ],
    "createdAt": "2026-01-27T10:00:00Z",
    "updatedAt": "2026-01-27T10:15:00Z",
    "analyzedAt": "2026-01-27T10:15:00Z"
  }
]
```

### 2. Specifications
**Directory:** `./specifications/`
**Format:** Markdown files
**Created by:** Dragon agent
**Content:** Project requirements, features, technical details

**Example:**
```
./specifications/
  ├── MyWebApp_specification.md
  ├── TaskManager_specification.md
  └── APIService_specification.md
```

### 3. Output Code
**Directory:** `./workspace/{ProjectName}/`
**Format:** Actual code files
**Created by:** Kobold agents
**Content:** Working application code

**Example:**
```
./workspace/MyWebApp/
  ├── src/
  │   ├── index.html
  │   ├── app.js
  │   └── styles.css
  ├── package.json
  └── README.md
```

### 4. Task Files
**Directory:** Generated by Wyrm during analysis
**Format:** JSON task definitions
**Referenced:** In project.taskFiles array

## Project States

| Status | Description | Next Step |
|--------|-------------|-----------|
| `New` | Just created, no Wyrm assigned | Wyrm assignment |
| `Analyzing` | Wyrm is analyzing specification | Wait for completion |
| `Analyzed` | Tasks generated, ready for Drake | Drake supervision |
| `InProgress` | Kobolds working on tasks | Wait for completion |
| `Complete` | All tasks done | Ready to use! |
| `Error` | Something went wrong | Check error message |

## API Endpoints

### GET /api/projects
Returns all projects
```json
[
  {
    "id": "...",
    "name": "MyProject",
    "status": "New",
    ...
  }
]
```

### GET /api/projects/{id}/providers
Returns project-specific provider settings
```json
{
  "projectId": "...",
  "projectName": "MyProject",
  "providers": {
    "wyrmEnabled": true,
    "wyrmProvider": "openai",
    "drakeEnabled": true,
    "drakeProvider": "claude",
    ...
  }
}
```

## When You See Empty Lists

**Dragon page shows no projects?**
✅ Normal! You haven't created any yet.

**How to create first project:**
1. Open Dragon page
2. Enter a project name (or create new)
3. Select AI provider
4. Start chatting with Dragon
5. Describe what you want to build
6. Dragon will create specification
7. Project automatically appears!

## Verification

To verify everything is working:

1. **Check if file will be created:**
   ```bash
   # After creating a project through Dragon
   cat ./projects/projects.json
   ```

2. **Check specifications:**
   ```bash
   ls ./specifications/
   ```

3. **Check workspace:**
   ```bash
   ls ./workspace/
   ```

4. **Via API:**
   ```bash
   curl http://localhost:{client-port}/api/projects
   ```

## Important Notes

- ✅ **Real Data:** Everything is stored and persisted
- ✅ **Automatic:** Projects are registered automatically by Dragon
- ✅ **Persistent:** Data survives server restarts
- ✅ **Thread-Safe:** Repository uses locking for concurrent access
- ❌ **No Seed Data:** System starts empty intentionally
- ❌ **No Sample Projects:** You create what you need

## Summary

**Are projects placeholders?**  
❌ NO - They are real, persistent data stored in JSON files.

**Why don't I see any?**  
✅ You haven't created any yet. Start with Dragon!

**Will they persist?**  
✅ Yes, they're saved to disk and reload on server restart.

**How do I create one?**  
✅ Use Dragon to discuss a project and create a specification.
